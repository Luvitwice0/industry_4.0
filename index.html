<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>

    <script src="https://kit.fontawesome.com/7013ed1e06.js" crossorigin="anonymous"></script>

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

      <!-- Search with Dropdown -->
      <link href="assets/dist/css/select2.min.css" rel="stylesheet"/>
      <script src="assets/dist/js/select2.min.js"></script>
</head>
<style>
    body
    {
        margin: auto;
        /* padding: 20px; */
        font-family: "Roboto", "Helvetica", "Arial", sans-serif;
    }
    .main-container
    {
        padding: 20px;
    }
    .select2-container 
    {
    z-index: 1060; 
    }

</style>
<body>
    <div class="main-container">
       
        <br>
        <div class="container">
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#create_production_plan">
                Create <i class="fa fa-plus"></i>
            </button>
        </div>
        <br>
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <table id="tableID" class="table table-striped table-bordered table-responsive table-hover">
                        <thead class="bg-gradient">
                            <tr>
                                <th class="text-center">Production ID</th>
                                <th>Order no</th>
                                <th>Customer</th>
                                <th class="text-center">Part no</th>
                                <th class="text-center">Completed quantity</th>
                                <th class="text-center">Target quantity</th>
                                <th class="text-center">From date</th>
                                <th class="text-center">To date</th>
                                <th class="text-center">Production history</th>
                                <th class="text-center">Action</th>
                            </tr>
                        </thead>
                        <tbody class="text-center" id="prodction_plan">
                           
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- model for create production plan -->

    <div class="modal fade" id="create_production_plan" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="staticBackdropLabel">Create Production Plan</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <label for="prodId">Production ID</label>
                            <input class="form-control" id="prodId"></input>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="orderNo">Order No</label>
                                <input class="form-control" id="orderNo"></input>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="selectcustomerName">Customer Name</label>
                                <select
                                        style="width:100%"
                                        id="selectcustomerName"
                                        class="js-example-basic-single"
                                        >
                                        <option>Select Drop Customer</option>
                                        <option>Customer A</option>
                                        <option>Customer B</option>
                                        <option>Customer C</option>
                                        <option>Customer D</option>
                                        <option>Customer D</option>
                                        <option>Customer E</option>
                                    </select>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="partNo">Part No</label>
                                <input class="form-control" id="partNo"></input>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="partName">Part Name</label>
                                <input class="form-control" id="partName"></input>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="prodQuantity">Production Quantity</label>
                                <input class="form-control" id="prodQuantity"></input>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="fdate">From Date</label>
                                    <input  type="date" class="form-control" id="fdate"></input>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="tdate">To Date</label>
                                    <input  type="date" class="form-control" id="tdate"></input>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-success">Save <i class="fa fa-check"></i></button>
            </div>
          </div>
        </div>
      </div>
      <script>
        $(document).ready(function () {
            $('.js-example-basic-single').select2();
        });
    </script>
    <script>
        var dataTableInitialized = false;
        var table;

        function getDataAndUpdateTable() 
        {
            var xhr = new XMLHttpRequest();

            xhr.onreadystatechange = function () 
            {
                if (xhr.readyState === XMLHttpRequest.DONE) 
                {
                    if (xhr.status === 200) 
                    {
                        var response = xhr.responseText;
                        var jsonData = JSON.parse(response);
                        updateTable(jsonData.production_plan);
                        console.log(jsonData)

                        if (dataTableInitialized) 
                        {
                            table.destroy();
                        }
                        initDataTable();
                        dataTableInitialized = true;
                    } 
                    else 
                    {
                        console.error("Failed to fetch data from the server.");
                    }
                    // setTimeout(getDataAndUpdateTable, 5000);
                }
            };

            xhr.open("GET", "production_plan.json", true);
            xhr.send();
        }
        function updateTable(data) 
        {
            console.log("1");
            var tableBody = document.getElementById("prodction_plan");
            tableBody.innerHTML = "";

            var today = new Date();
            var emptyJson = [];

            for (var i = 0; i < data.length; i++) 
            {
                var entry = data[i];

                if (entry.probid !== "" && entry.ordno !== "" && entry.customer !== "" && entry.partno !== "" && entry.completedquantity !== "" && entry.targetquantity !== "" && entry.fdate !== "" && entry.tdate !== "" && entry.probhistory !== "") {
                    emptyJson.push(entry);
                }
            }

            for (var i = 0; i < emptyJson.length; i++) 
            {
                var entry1 = emptyJson[i];

                const row = document.createElement("tr");

                var perductionTDCell = document.createElement("td");
                perductionTDCell.textContent = entry1.probid;
                row.appendChild(perductionTDCell);

                var orderNoCell = document.createElement("td");
                orderNoCell.textContent = entry1.ordno;
                row.appendChild(orderNoCell);

                var customerNameCell = document.createElement("td");
                customerNameCell.textContent = entry1.customer;
                row.appendChild(customerNameCell);

                var partNoCell = document.createElement("td");
                partNoCell.textContent = entry1.partno;
                row.appendChild(partNoCell);

                var completedQuantityCell = document.createElement("td");
                completedQuantityCell.textContent = entry1.completedquantity;
                row.appendChild(completedQuantityCell);

                var targetQuantityCell = document.createElement("td");
                targetQuantityCell.textContent = entry1.targetquantity;
                row.appendChild(targetQuantityCell);

                var fromDateCell = document.createElement("td");
                fromDateCell.textContent = entry1.fdate;
                row.appendChild(fromDateCell);

                var todayDateCell = document.createElement("td");
                todayDateCell.textContent = entry1.tdate;
                row.appendChild(todayDateCell);

                var productionHisCell = document.createElement("td");
                productionHisCell.textContent = entry1.probhistory;
                row.appendChild(productionHisCell);

                var delectCell = document.createElement("td");
                delectCell.innerHTML = `<button type="button" class="btn btn-danger">
                                            <i class="fa fa-trash" style=" font-size: smaller;"></i>
                                        </button>`;
                row.appendChild(delectCell);

                tableBody.appendChild(row);
            }
        }
        getDataAndUpdateTable();
    </script>
    <script>
        function initDataTable() 
        {
            table = $('#tableID').DataTable({
                language: {
                    "searchPlaceholder": "Search records",
                    "search": ""
                },
                lengthMenu: [10, 25, 50, 100],
                fnDrawCallback: function () {
                    $("input[type='search']").attr("class", "searchBox");
                    $('div.dataTables_length select').attr("class", "selectBox");
                }
            });
        }

    getDataAndUpdateTable();
    </script>
</body>
</html>