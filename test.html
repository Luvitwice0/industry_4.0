<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

        <!-- Font Awesome Kit -->
        <script src="https://kit.fontawesome.com/7013ed1e06.js" crossorigin="anonymous"></script>

        <!-- DataTables CSS -->
        <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
        <!-- Select2 CSS -->
        <link href="assets/dist/css/select2.min.css" rel="stylesheet"/>

        <!-- jQuery -->
        <script src="https://code.jquery.com/jquery-3.7.0.js"></script>

        <!-- Bootstrap JS Bundle -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

        <!-- DataTables JS -->
        <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

        <!-- Select2 JS -->
        <script src="assets/dist/js/select2.min.js"></script>

        <script type="text/javascript" src="assets/daterangepicker-master/moment.min.js"></script>
        <script type="text/javascript" src="assets/daterangepicker-master/daterangepicker.js"></script>
        <link rel="stylesheet" type="text/css" media="all" href="assets/daterangepicker-master/daterangepicker.css">
    </head>
    <style>
        body 
        {
            margin: auto;
            /* padding: 20px; */
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
        }
        .main-container 
        {
            padding: 10px;
        }
        .select2-container 
        {
            z-index: 3060;
        }
        .input-field 
        {
            position: relative;
        }
        .input-field input 
        {
            width: 100%;
            height: 40px;
            border-radius: 3px;
            font-size: 18px;
            padding: 0 15px;
            border: 2px solid #bababa;
            background: transparent;
            color: #000000;
            outline: none;
        }
        .input-field label 
        {
            position: absolute;
            top: 50%;
            left: 15px;
            transform: translateY(-50%);
            color: #212529;
            font-size: 16px;
            pointer-events: none;
            transition: 0.3s;
        }
        input:focus
        {
            border: 2px solid #0d6efd;
        }

        input:focus ~ label 
        {
            color: #0d6efd;
        }
        input:focus ~ label,
        input:valid ~ label
        {
            top: 0;
            left: 15px;
            font-size: 16px;
            padding: 0 2px;
            background-color: white;
        }
        .required-field 
        {
            border: 2px solid #f80000 !important;
        }

    </style>
    <body>
        <div class="main-container">
            <a href="home.html" style="text-decoration: none;">
                <h5 style="float: left;">Home/</a>Add Raw Items</h5>
            <br>
            <hr>
            <br>

            <div class="container">
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#create_production_plan" style="border-radius: 2px;">
                    Add Raw Item
                    <i class="fa fa-plus"></i>
                </button>
            </div>
            <br>
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <table
                            id="example"
                            class="table table-striped table-bordered table-responsive table-hover">
                            <thead class="bg-gradient">
                                <tr>
                                    <th class="text-center">Item Name</th>
                                    <th class="text-center">Item no</th>
                                    <th class="text-center">UoM</th>
                                    <th class="text-center">Price</th>
                                    <th class="text-center">Type</th>
                                    <th class="text-center">Details</th>
                                    <!-- <th class="text-center">Target quantity</th> <th class="text-center">From
                                    date</th> <th class="text-center">To date</th> <th
                                    class="text-center">Production history</th> -->
                                    <th class="text-center">Action</th>
                                </tr>
                            </thead>
                            <tbody class="text-center" id="prodction_plan">
                                
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- model for create production plan -->

        <div class="modal fade" id="create_production_plan" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content" style=" border-radius: 2px; ">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="staticBackdropLabel">Add Raw Item</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div>
                            <div class="row">
                                <div class="col-md-12">
                                    <!-- <div class="form-group"> <label for="prodId">Production ID</label> <input
                                    class="form-control" id="prodId"></input> </div> -->
                                    <div class="input-field">
                                        <input type="text" required="required" spellcheck="false" id="R_iname">
                                        <label for="R_iname">Item Name</label>
                                    </div>
                                    <br>
                                    <div class="col-md-12">
                                        <!-- <div class="form-group"> <label for="orderNo">Order No</label> <input
                                        class="form-control" id="orderNo"></input> </div> -->
                                        <div class="input-field">
                                            <input type="text" required="required" spellcheck="false" id="R_ino">
                                            <label for="R_ino">Item No</label>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label for="selectcustomerName">Choose a Category</label>
                                            <select
                                                style="width:100%"
                                                id="selectcustomerName"
                                                class="js-example-basic-single">
                                                <option>Select Drop Customer</option>
                                            </select>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="col-md-12">
                                        <!-- <div class="form-group"> <label for="partNo">Part No</label> <input
                                        class="form-control" id="partNo"></input> </div> -->
                                        <div class="input-field">
                                            <input type="text" required="required" spellcheck="false" id="R_iprice">
                                            <label for="R_iprice">Price</label>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <p>UoM (Unit of Measure)</p>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="kg">
                                                <label class="form-check-label" for="inlineRadio1">Kg</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="Liter">
                                                <label class="form-check-label" for="inlineRadio2">Liter</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="mm">
                                                <label class="form-check-label" for="inlineRadio2">mm</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="cm">
                                                <label class="form-check-label" for="inlineRadio2">cm</label>
                                            </div>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button  type="button"  class="btn btn-success"  onclick="addRawItemData()" style="  border-radius: 2px; ">Save
                            <i class="fa fa-check"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="offcanvasRightLabel">Offcanvas right</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>


            <div class="offcanvas-body">
                ...
            </div>
        </div>

        <script>
            function addRawItemData()
            {
                var rawItemsData = ["R_iname", "R_ino", "selectcustomerName", "R_iprice"]
                var emptyData = false

                for(var i=0; i<rawItemsData.length; i++)
                {
                    var rawItemDatax = rawItemsData[i];
                    var input = document.getElementById(rawItemDatax);
                    var value = input.value.trim();

                    if(value === "")
                    {
                        input.classList.add("required-field");
                        emptyData=true
                    }
                    else
                    {
                        input.classList.remove("required-field")
                    }
                }
                if(emptyData)
                {
                    return;
                }
                var ele = document.getElementsByName('inlineRadioOptions');
                for (i = 0; i < ele.length; i++) 
                {
                    if (ele[i].checked)
                    {
                        var selected_values = ele[i].value
                        // JsonDatax.push(selected_values)
                        console.log(selected_values)
                    }
                }

                var R_iname = document.getElementById("R_iname").value;
                var R_ino = document.getElementById("R_ino").value;
                var selectcustomerName = document.getElementById("selectcustomerName").value;
                var R_iprice = document.getElementById("R_iprice").value;

                var JsonDatax = 
                {
                    Raw_Item_name : R_iname,
                    Raw_Item_no : R_ino,
                    Raw_Item_cat : selectcustomerName,
                    Raw_item_price : R_iprice,
                    UoM : selected_values
                }

                console.log(JsonDatax)
            }
        </script>
        <script>
            var dataTableInitialized = false;

            function updateTableData()
            {
                var xhr = new XMLHttpRequest();

                xhr.onreadystatechange = function()
                {
                    if(xhr.readyState === XMLHttpRequest.DONE)
                    {
                        if(xhr.status == 200)
                        {
                            var response = xhr.responseText;
                            var jsonData = JSON.parse(response);
                            console.log(jsonData)
                            updateDataToTable(jsonData.add_raw_items);
                            updateDropdownOptions(jsonData.add_raw_items)
                            // Initialize DataTables if it hasn't been initialized already
                            if (!dataTableInitialized) 
                            {
                                initDataTable();
                                dataTableInitialized = true; // Set the flag to true
                            }
                        }
                        else
                        {
                            console.error("failed to get the data from server")
                        }
                        
                    }
                    
                }
                xhr.open("GET","02_rew_items.json",true)
                xhr.send();
            }

            function updateDataToTable(jsonDatax)
            {
                var data = jsonDatax
                for(var i=0; i<data.length;i++)
                {
                    var taleBody = document.getElementById("prodction_plan");

                    var datax = data[i];
                    // var uomx = datax.p_uom;
                    // console.log(uomx)

                    var tableRow = document.createElement("tr");

                    var item_name = document.createElement("td");
                    item_name.textContent = datax.p_item_name;
                    tableRow.appendChild(item_name);

                    var item_no = document.createElement("td");
                    item_no.textContent = datax.p_item_no;
                    tableRow.appendChild(item_no);

                    var umox = document.createElement("td");
                    umox.textContent=datax.p_uom;
                    tableRow.appendChild(umox);

                    var price = document.createElement("td");
                    price.textContent = datax.p_price;
                    tableRow.appendChild(price); 

                    var type = document.createElement("td");
                    type.textContent = datax.type;
                    tableRow.append(type);

                    var details = document.createElement("td");
                    details.innerHTML = `<button class="btn btn-secondary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight" style="border-radius: 2px;">View</button>`
                    tableRow.appendChild(details);

                    var action = document.createElement("td");
                    action.innerHTML = ` <button type="button" class="btn btn-danger" onclick="deleteRow('${i}')" style="border-radius: 2px;">
                                            <i class="fa fa-trash" style=" font-size: smaller;" aria-hidden="true"></i>
                                        </button>`
                    tableRow.appendChild(action);

                    taleBody.appendChild(tableRow);

                }
            }

            updateTableData();

            function updateDropdownOptions(data) 
            {
                console.log(1);
                var employeeSelect = document.getElementById("selectcustomerName");
                employeeSelect.innerHTML = '<option value=""><--Select File name --></option>';
                
                var employeeNames = [];

                for (var i = 0; i < data.length; i++) 
                {
                    var entry = data[i];

                    if (entry.p_item_name && employeeNames.indexOf(entry.p_item_name) === -1) 
                    {
                        employeeNames.push(entry.p_item_name);

                        var option = document.createElement("option");
                        option.value = entry.p_item_name;
                        option.textContent = entry.p_item_name;
                        employeeSelect.appendChild(option);
            
                        console.log(employeeSelect.appendChild(option))
                    }
                }
            }
        </script>
        <script>
            function deleteRow(rowIndex)
            {
                var clickedRow = rowIndex;

                console.log(clickedRow)
            }
        </script>
        <script>
            $(document).ready(function () {
                $('.js-example-basic-single').select2();
            });
        </script>
        <script>
            function initDataTable() 
            {
                $('#example').DataTable({
                    language: {
                        "searchPlaceholder": "Search records",
                        "search": ""
                    },
                    lengthMenu: [10, 25, 50, 100],
                    fnDrawCallback: function () {
                        $("input[type='search']").attr("class", "searchBox");
                        $('div.dataTables_length select').attr("class", "selectBox");
                    }
                });
            }
            // updateTableData();
        </script>
        <script type="text/javascript">
            $(function () {

                var start = moment().subtract(29, 'days');
                var end = moment();

                function cb(start, end) {
                    $('#reportrange span').html(
                        start.format('D MMMM, YYYY') + ' - ' + end.format('D MMMM, YYYY')
                    );
                }

                $('#reportrange').daterangepicker({
                    startDate: start,
                    endDate: end,
                    ranges: {
                        'Today': [
                            moment(), moment()
                        ],
                        'Last 7 Days': [
                            moment().subtract(6, 'days'),
                            moment()
                        ],
                        'Last 30 Days': [
                            moment().subtract(29, 'days'),
                            moment()
                        ]
                    }
                }, cb);

                cb(start, end);

            });
        </script>
    </body>
</html>