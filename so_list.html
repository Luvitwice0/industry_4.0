<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tabulator Example</title>
    <!-- DATE PICKER -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <!-- FONT AWESOME -->
    <!-- Font Awesome Kit -->
    <script src="https://kit.fontawesome.com/7013ed1e06.js" crossorigin="anonymous"></script>

    <!-- BOOTSTRAP CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- BOOTSTRAP JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/5.2.0/css/tabulator.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        integrity="sha384-d56yE0tfrqxxqj5j9K3tgNQA9R2eHgHg9N6pKI3PmAK6gYUpGG3jYFJF3aCb7bZv" crossorigin="anonymous">
        <style>
            body {
                font-family: 'Arial', sans-serif;
                margin: 0;
                padding: 0;
            }
        
            #example-table {
                margin: 10px;
                max-width: 100vw;
                background-color: #fff;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
                /* overflow-x: hidden; */
            }

            .table-container {
                max-height: 1000px;
                overflow-y: auto;
            }
        
            .tabulator-row {
                border-bottom: 1px solid lightgray;
                min-height: 40px;
            }
        
            .tabulator-col {
                height: 40px;
            }
        
            .tabulator-col-title {
                line-height: 40px;
                text-align: center;
            }
        
            .nested-row {
                cursor: pointer;
                color: black;
                text-decoration: underline;
            }
        
            .primary-btn {
                display: inline-block;
                padding: 8px 12px;
                background-color: #007bff;
                color: #fff;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }
        
            .workorder-card {
                border: 1px solid #ccc;
                padding: 10px;
                margin-bottom: 10px;
                cursor: pointer;
            }
        
            .jobcard {
                padding: 5px;
                margin-left: 20px;
            }
        
            /* Add this style for table borders in the modal */
            #vertically-centered table {
                border-collapse: collapse;
                width: 100%;
            }
        
            #vertically-centered th,
            #vertically-centered td {
                border: 1px solid black;
                padding: 10px;
            }
        
            .tabulator-pagination .tabulator-page[data-page="first"],
            .tabulator-pagination .tabulator-page[data-page="last"],
            .tabulator-pagination .tabulator-page[data-page="first"] + .tabulator-page,
            .tabulator-pagination .tabulator-page[data-page="last"] + .tabulator-page {
                display: none;
            }
        </style>
        
        
        
        
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/5.2.0/js/tabulator.min.js"></script>
</head>

<body>
    
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid" style="margin-top: 12px;">
            <div>
                <!-- <label for="customerFilter">Filter by Customer:</label> -->
                <select style="width: 100%; height: 36px; color: gray;" id="customerFilter" onchange="filterByCustomer()">
                    <option value="">Fiter by Customers</option>
                </select>
                
            </div>
          <a class="navbar-brand" href="#"></a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <select style="width: 110%; height: 36px; color: gray;" id="processFilter" onchange="filterByProcess()">
                    <option value="">Filter by Process</option>
                </select>
              </li>
            </ul>
            <form class="d-flex">
                <input style="margin-right: 1px; border-radius: 4px; border: 1px solid lightgray; padding: 5px;height: 40px;" type="text" name="daterange" value="01/01/2024 - 01/15/2024" />
                <button style="border: none; background-color: white; font-size: larger;"><i class="fas fa-filter"></i></button>
                <!-- <input class="form-control me-2" style="width: 40%;" type="search" placeholder="Search" aria-label="Search"> -->
                <input type="text" id="table-search" placeholder="Search" class="form-control me-2" style="width: 40%;" >
                <button class="btn btn-outline-success" type="submit">Search</button>
            </form>
          </div>
        </div>
      </nav>
    <div id="example-table"></div>
    <div class="modal" tabindex="-1">
        <div class="modal-dialog">
           <div class="modal-content">
              <div class="modal-header">
                 <h5 class="modal-title">Modal Title</h5>
                 <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                 <p>WorkOrder1 <i style="cursor: pointer;" class="fas fa-eye" onclick="openPopup()"></i></p>
                 <p>WorkOrder2 <i style="cursor: pointer;" class="fas fa-eye" onclick="openPopup()"></i></p>
                 <p>WorkOrder3 <i style="cursor: pointer;" class="fas fa-eye" onclick="openPopup()"></i></p>
                 <p>WorkOrder3 <i style="cursor: pointer;" class="fas fa-eye" onclick="openPopup()"></i></p>
              </div>
              <div class="modal-footer">
                 <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button> -->
              </div>
           </div>
        </div>
     </div>
    <!-- JC DETAILS -->
    <div tabindex="-1" class="modal pmd-modal fade" id="vertically-centered" style="display: none;" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">JobCard Details</h2>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    <span class="glyphicon glyphicon-remove"></span>
                </div>
                <div class="modal-body">
                    <table style="width: 100%;text-align: center; border: 1px solid black; padding: 10px;">
                        <tbody>
                            <tr>
                                <td>
                                    Jobcard No
                                </td>
                                <td>
                                    124234GHF
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Operator Name
                                </td>
                                <td>
                                    Chintu
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Machine No
                                </td>
                                <td>
                                    1123245WOK
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Quantity
                                </td>
                                <td>
                                    500
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Shift
                                </td>
                                <td>
                                    Shift 1
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Accepted Quantity
                                </td>
                                <td>
                                    450
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Rejected Quantity
                                </td>
                                <td>
                                    50
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    status
                                </td>
                                <td>
                                    <div class="badge bg-success" style="padding: 5px;">Completed</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script>
        var table;

        $(document).ready(function () {
            var customerOptions = getUniqueValues(tableDataNested, 'customer');
            populateDropdown('customerFilter', customerOptions);
            $("#table-search").on("input", function () {
                var searchString = $(this).val();
                table.setFilter("salesorder", "like", searchString);
            });
        });


        function getUniqueValues(data, field) {
            return [...new Set(data.map(item => item[field]))];
        }

        function populateDropdown(dropdownId, options) {
            var dropdown = document.getElementById(dropdownId);
            dropdown.innerHTML = "<option value=''>Filter by Customers</option>";

            options.forEach(function (option) {
                var newOption = document.createElement('option');
                newOption.value = option;
                newOption.text = option;
                dropdown.add(newOption);
            });
        }
        
    </script>

    <script>
        function openPopup() {
            $('#vertically-centered').modal('show');
        }
    </script>
    <script>
        $(function() {
          $('input[name="daterange"]').daterangepicker({
            opens: 'left'
          }, function(start, end, label) {
            console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
          });
        });
    </script>
    <script>
        var tableDataNested = [
            {
                salesorder: "Salesorder001", customer: "customer001", deliveryDate: "20/10/2024", quantity: 450, processes: [], _children: [
                    {
                        salesorder: "MasterProduct001", customer: "customer001", deliveryDate: "20/10/2024", quantity: 450, processes: ["bending", "assembly"], _children: [
                            {
                                salesorder: "Item001", customer: "customer001", deliveryDate: "20/10/2024", quantity: 450, processes: ["bending", "powder Coating", "welding", "punching", "cutting","Quality Check"], action: `<button class='primary-btn' onclick='viewAction()'>View</button> <i class='fas fa-eye'></i>`, _children: [
                                    { salesorder: "SubItem001", customer: "customer001", deliveryDate: "20/10/2024", quantity: 450, processes: ["Powder Coating",] },
                                    { salesorder: "SubItem002", customer: "customer001", deliveryDate: "20/10/2024", quantity: 450, processes: ["cutting"] }
                                ]
                            },
                            { salesorder: "Item002", customer: "customer001", deliveryDate: "20/10/2024", quantity: 450, processes: ["welding"] }
                        ]
                    },
                    { salesorder: "MasterProduct002", customer: "customer001", deliveryDate: "20/10/2024", quantity: 450, processes: ["assembly", "Powder coating"] }
                ]
            },
            {
                salesorder: "Salesorder002", customer: "customer001", deliveryDate: "20/10/2024", quantity: 450, processes: [], _children: [
                    {
                        salesorder: "MasterProduct001", customer: "customer001", deliveryDate: "20/10/2024", quantity: 450, processes: ["bending", "assembly"], _children: [
                            {
                                salesorder: "Item001", customer: "customer001", deliveryDate: "20/10/2024", quantity: 450, processes: ["bending", "powder Coating", "welding", "punching", "cutting","Quality Check"], action: `<button class='primary-btn' onclick='viewAction()'>View</button> <i class='fas fa-eye'></i>`, _children: [
                                    { salesorder: "SubItem001", customer: "customer001", deliveryDate: "20/10/2024", quantity: 450, processes: ["Powder Coating",] },
                                    { salesorder: "SubItem002", customer: "customer001", deliveryDate: "20/10/2024", quantity: 450, processes: ["cutting"] }
                                ]
                            },
                            { salesorder: "Item002", customer: "customer001", deliveryDate: "20/10/2024", quantity: 450, processes: ["welding"] }
                        ]
                    },
                    { salesorder: "MasterProduct002", customer: "customer001", deliveryDate: "20/10/2024", quantity: 450, processes: ["assembly", "Powder coating"] }
                ]
            }
        ];

        
        var table = new Tabulator("#example-table", {
        height: "100%",
        data: tableDataNested,
        dataTree: true,
        dataTreeStartExpanded: true,
        layout: "fitColumns",
        pagination: "local",
        paginationSize: 10, 
        paginationButtonSource: ["<<", "<", ">", ">>"],
        columns: [
            { title: "SalesOrder ID", field: "salesorder", hozAlign: "left", width: 350 },
            { title: "Customer Name", field: "customer", hozAlign: "left", width: 220 },
            { title: "Delivery Date", field: "deliveryDate", hozAlign: "center", width: 220 },
            { title: "Quantity", field: "quantity", hozAlign: "center", width: 220 },
            { title: "Processes", field: "processes", hozAlign: "left", width: "550", widthShrink: 1, formatter: processFormatter },
        ],
        rowFormatter: function (row) {
            var data = row.getData();

            if (data._children) {
                row.getElement().classList.add("nested-row");
            }
        },
        rowClick: function (e, row) {
            var data = row.getData();

            if (data._children) {
                row.toggleData();
            }
        },
        dataLoaded: function () {
            var rows = table.getRows();
        },
    });

    function processFormatter(cell, formatterParams, onRendered) {
        var processes = cell.getValue();
        var buttons = processes.map(process => `<button class="primary-btn" onclick="processClicked('${process}')">${process}</button>`);
        var el = document.createElement("div");
        el.innerHTML = buttons.join(" ");
        return el;
    }

    function processClicked(process) {
        var modal = new bootstrap.Modal(document.querySelector('.modal'), {
            centered: true
        });

        document.querySelector('.modal-title').innerText = 'Process Clicked: ' + process;

        modal.show();
    }

    


        
        
        
    </script>
</body>

</html>