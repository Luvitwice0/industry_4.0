<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tabulator Example</title>
    <!-- DATE PICKER -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <!-- FONT AWESOME -->
    <!-- Font Awesome Kit -->
    <script src="https://kit.fontawesome.com/7013ed1e06.js" crossorigin="anonymous"></script>

    <!-- BOOTSTRAP CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- BOOTSTRAP JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/5.2.0/css/tabulator.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        integrity="sha384-d56yE0tfrqxxqj5j9K3tgNQA9R2eHgHg9N6pKI3PmAK6gYUpGG3jYFJF3aCb7bZv" crossorigin="anonymous">
        <style>
            body {
                font-family: 'Arial', sans-serif;
                margin: 0;
                padding: 0;
                overflow: hidden;
            }
        
            #example-table {
                margin: 10px; /* Remove the margin */
                max-width: 100vw; /* Use 100vw to make it full width */
                background-color: #fff;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
                overflow-x: hidden;
            }
        
            .tabulator-row {
                border-bottom: 1px solid lightgray;
                min-height: 40px;
            }
        
            .tabulator-col {
                height: 40px;
            }
        
            .tabulator-col-title {
                line-height: 40px;
                text-align: center;
            }
        
            .nested-row {
                cursor: pointer;
                color: black;
                text-decoration: underline;
            }
        
            .primary-btn {
                display: inline-block;
                padding: 8px 12px;
                background-color: #007bff;
                color: #fff;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }
            .workorder-card {
                border: 1px solid #ccc;
                padding: 10px;
                margin-bottom: 10px;
                cursor: pointer;
            }

            .jobcard {
                padding: 5px;
                margin-left: 20px;
            }
        </style>
        
        
        
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/5.2.0/js/tabulator.min.js"></script>
</head>

<body>
    
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid" style="margin-top: 12px;">
            <div>
                <!-- <label for="customerFilter">Filter by Customer:</label> -->
                <select style="width: 150%; height: 36px; color: gray;" id="customerFilter" onchange="filterByCustomer()">
                    <option value="">Fiter by Customers</option>
                </select>
            </div>
          <a class="navbar-brand" href="#"></a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true"></a>
              </li>
            </ul>
            <form class="d-flex">
                <input style="margin-right: 10px; border-radius: 4px; border: 1px solid lightgray; padding: 5px;height: 40px;" type="text" name="daterange" value="01/01/2018 - 01/15/2018" />
                <button style="margin-right: 35px; border: none; background-color: white; font-size: larger;"><i class="fas fa-filter"></i></button>
                <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-success" type="submit">Search</button>
            </form>
          </div>
        </div>
      </nav>
    <div id="example-table"></div>
    <div class="modal" tabindex="-1">
        <div class="modal-dialog">
           <div class="modal-content">
              <div class="modal-header">
                 <h5 class="modal-title">Modal Title</h5>
                 <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                 <p>Modal content goes here.</p>
              </div>
              <div class="modal-footer">
                 <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button> -->
              </div>
           </div>
        </div>
     </div>
     
    <script>
        $(function() {
          $('input[name="daterange"]').daterangepicker({
            opens: 'left'
          }, function(start, end, label) {
            console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
          });
        });
    </script>
    <script>
        var tableDataNested = [
            {
                salesorder: "salesorder001", customer: "customer001", deliveryDate: "20/10/0223", quantity: 450, processes: ["bending", "welding"], _children: [
                    {
                        salesorder: "MasterProduct001", customer: "customer001", deliveryDate: "20/10/0223", quantity: 450, processes: ["bending", "assembly"], _children: [
                            {
                                salesorder: "Item001", customer: "customer001", deliveryDate: "20/10/0223", quantity: 450, processes: ["bending", "powder Coating", "welding", "punching", "cutting","Quality Check"], action: `<button class='primary-btn' onclick='viewAction()'>View</button> <i class='fas fa-eye'></i>`, _children: [
                                    { salesorder: "SubItem001", customer: "customer001", deliveryDate: "20/10/0223", quantity: 450, processes: ["bending",] },
                                    { salesorder: "SubItem002", customer: "customer001", deliveryDate: "20/10/0223", quantity: 450, processes: ["bending", "cutting"] }
                                ]
                            },
                            { salesorder: "Item002", customer: "customer001", deliveryDate: "20/10/0223", quantity: 450, processes: ["welding"] }
                        ]
                    },
                    { salesorder: "MasterProduct002", customer: "customer001", deliveryDate: "20/10/0223", quantity: 450, processes: ["assembly", "Powder coating"] }
                ]
            },
        ];

        var table = new Tabulator("#example-table", {
            height: "100%",
            data: tableDataNested,
            dataTree: true,
            dataTreeStartExpanded: true,
            layout: "fitColumns",
            columns: [
                { title: "SalesOrder ID", field: "salesorder", hozAlign: "left", width: 350 },
                { title: "Customer Name", field: "customer", hozAlign: "left", width: 220 },
                { title: "Delivery Date", field: "deliveryDate", hozAlign: "center", width: 220 },
                { title: "Quantity", field: "quantity", hozAlign: "center", width: 220 },
                { title: "Processes", field: "processes", hozAlign: "left", width: "550", widthShrink: 1, formatter: processFormatter },
            ],
            rowFormatter: function (row) {
                var data = row.getData();

                if (data._children) {
                    // Add a class to the row to make it clickable
                    row.getElement().classList.add("nested-row");
                }
            },
            rowClick: function (e, row) {
                var data = row.getData();

                if (data._children) {
                    row.toggleData();
                }
            },
            dataLoaded: function () {
                var rows = table.getRows();
            },
        });

        function processFormatter(cell, formatterParams, onRendered) {
            // Custom formatter for the "Processes" column
            var processes = cell.getValue();
            var buttons = processes.map(process => `<button class="primary-btn" onclick="processClicked('${process}')">${process}</button>`);
            var el = document.createElement("div");
            el.innerHTML = buttons.join(" ");
            return el;
        }

        function processClicked(process) {
            var modal = new bootstrap.Modal(document.querySelector('.modal'), {
                centered: true
            });
            document.querySelector('.modal-title').innerText = 'Process Clicked';
            document.querySelector('.modal-body p').innerText = `Process clicked: ${process}`;
            modal.show();
        }
        var uniqueCustomers = Array.from(new Set(tableDataNested.map(item => item.customer)));
        var customerFilterDropdown = document.getElementById('customerFilter');

        uniqueCustomers.forEach(customer => {
            var option = document.createElement('option');
            option.value = customer;
            option.text = customer;
            customerFilterDropdown.appendChild(option);
        });

        function filterByCustomer() {
            var selectedCustomer = customerFilterDropdown.value;
            table.setFilter("customer", "=", selectedCustomer);
        }
        
        
    </script>
</body>

</html>